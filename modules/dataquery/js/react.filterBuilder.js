!function(e){function t(a){if(s[a])return s[a].exports;var r=s[a]={exports:{},id:a,loaded:!1};return e[a].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var s={};return t.m=e,t.c=s,t.p="",t(0)}([function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});/**
	 *  The following file contains the components used for the filter builder tab
	 *
	 *  @author   Jordan Stirling <jstirling91@gmail.com>
	 *  @license  http://www.gnu.org/licenses/gpl-3.0.txt GPLv3
	 *  @link     https://github.com/mohadesz/Loris-Trunk
	 */
var s=React.createClass({displayName:"LogicOperator",changeOperator:function(e){this.props.updateGroupOperator(e)},render:function(){var e="btn",t="btn";return 1===this.props.logicOperator?(t+=" btn-primary",e+=" switch"):(e+=" btn-primary",t+=" switch"),React.createElement("div",{className:"btn-group",role:"group"},React.createElement("button",{type:"button",className:e,onClick:this.changeOperator.bind(this,0)},"And"),React.createElement("button",{type:"button",className:t,onClick:this.changeOperator.bind(this,1)},"Or"))}}),a=React.createClass({displayName:"FilterRule",getInitialState:function(){for(var e={},t=0;t<this.props.items.length;t++)e[this.props.items[t].category]=this.props.items[t].category;return{operators:{equal:"=",notEqual:"!=",lessThanEqual:"<=",greaterThanEqual:">=",startsWith:"startsWith",contains:"contains"},value:"",instruments:e}},componentWillMount:function(){this.valueSet=loris.debounce(this.valueSet,1e3)},selectInstrument:function(e){var t=this.props.rule,s=this;e&&(t.instrument=e,$.get(loris.BaseURL+"/AjaxHelper.php?Module=dataquery&script=datadictionary.php",{category:t.instrument},function(e){t.fields=e,s.props.updateRule(s.props.index,t)},"json"))},fieldSelect:function(e){var t=JSON.parse(JSON.stringify(this.props.rule));delete t.field,delete t.fieldType,delete t.operator,delete t.value,delete t.visit,delete t.candidates,e.target.value&&(t.field=t.fields[e.target.value].key[1],t.fieldType=t.fields[e.target.value].value.Type),this.props.updateRule(this.props.index,t)},operatorSelect:function(e){var t=JSON.parse(JSON.stringify(this.props.rule));delete t.operator,delete t.value,delete t.visit,delete t.candidates,e.target.value&&(t.operator=e.target.value),this.props.updateRule(this.props.index,t)},valueChange:function(e){var t=JSON.parse(JSON.stringify(this.props.rule));delete t.visit,delete t.candidates,t.value=e.target.value,this.setState({value:e.target.value}),this.valueSet(),this.props.updateRule(this.props.index,t)},valueSet:function(){var e=JSON.parse(JSON.stringify(this.props.rule)),t=this;if(this.state.value){var s=function(s){var a,r={},i={};for(a=0;a<s.length;a++)r[s[a][1]]||(r[s[a][1]]=[]),r[s[a][1]].push(s[a][0]),i[s[a][0]]||(i[s[a][0]]=[]),i[s[a][0]].push(s[a][1]);e.candidates={allCandiates:i,allSessions:r},e.session=Object.keys(i),e.visit="All",t.props.updateSessions(t.props.index,e)},a=function(a){$.get(loris.BaseURL+"/AjaxHelper.php?Module=dataquery&script="+a,{category:e.instrument,field:e.field,value:t.state.value},s,"json")};switch(e.operator){case"equal":a("queryEqual.php");break;case"notEqual":a("queryNotEqual.php");break;case"lessThanEqual":a("queryLessThanEqual.php");break;case"greaterThanEqual":a("queryGreaterThanEqual.php");break;case"startsWith":a("queryStartsWith.php");break;case"contains":a("queryContains.php")}}},updateVisit:function(e){var t=JSON.parse(JSON.stringify(this.props.rule));t.visit=e.target.value,"all"===e.target.value?t.session=Object.keys(t.candidates.allCandiates):t.session=t.candidates.allSessions[e.target.value],this.props.updateSessions(this.props.index,t)},render:function(){var e,t,s,a,r=this;if(this.props.rule.instrument){var i,l,p,n,o,c,u,d=this.props.rule.fields.map(function(e,s){return r.props.rule.field&&e.key[1]===r.props.rule.field&&(t=s),React.createElement("option",{value:s},e.key[1])}),h=[];if(this.props.rule.fieldType){u=this.props.rule.fieldType.split("("),p=u[0];for(var m in this.state.operators)h.push(React.createElement("option",{value:m,onChange:this.operatorSelect},this.state.operators[m]));if(c=this.props.rule.operator?this.props.rule.operator:"",n=React.createElement("select",{className:"input-sm col-xs-3 ",onChange:this.operatorSelect,value:c},React.createElement("option",{value:""}),h),this.props.rule.operator)switch(p){case"enum":i=enumToArray(this.props.rule.fieldType),o=i.map(function(e){return React.createElement("option",{value:e},e)}),c=this.props.rule.value?this.props.rule.value:"",l=React.createElement("select",{className:"input-sm col-xs-3",onChange:this.valueChange,value:c},React.createElement("option",{value:""}),o);break;default:l=React.createElement("input",{type:"text",className:"input-sm col-xs-3",onChange:this.valueChange,value:this.props.rule.value})}this.props.rule.visit&&(a=Object.keys(this.props.Visits).map(function(e){return React.createElement("option",{value:e},e)}),s=React.createElement("select",{className:"input-sm col-xs-3",onChange:this.updateVisit,value:this.props.rule.visit},React.createElement("option",{value:"all"},"All Visits"),a))}e=React.createElement("div",null,React.createElement("div",{className:"col-xs-12"},React.createElement("label",{className:"instrumentLabel"},this.props.rule.instrument)),React.createElement("div",{className:"col-xs-10"},React.createElement("select",{className:"input-sm col-xs-3",onChange:this.fieldSelect,value:t},React.createElement("option",{value:""}),d),n,l,s))}else e=React.createElement("div",{className:"col-xs-10"},React.createElement(SelectDropdown,{multi:!1,onFieldClick:this.selectInstrument,options:this.state.instruments,selectedCategory:""}));return React.createElement("div",{className:"panel panel-default"},React.createElement("div",{className:"panel-body"},e,React.createElement("div",{className:"col-xs-2"},React.createElement("button",{className:"btn btn-danger btn-sm pull-right",onClick:this.props.deleteRule.bind(this,this.props.index)},React.createElement("span",{className:"glyphicon glyphicon-remove"})," Delete"))))}}),r=React.createClass({displayName:"FilterGroup",updateChild:function(e,t){var s=this.props.group;s.children[e]=t,this.props.index?this.props.updateGroup(this.props.index,s):this.props.updateFilter(s)},updateGroupOperator:function(e){var t=this.props.group;t.activeOperator=e,t.session=getSessions(t),this.props.index?this.props.updateGroup(this.props.index,t):this.props.updateFilter(t)},updateSessions:function(e,t){var s=this.props.group;s.children[e]=t,s.session=getSessions(s),this.props.index?this.props.updateSessions(this.props.index,s):this.props.updateFilter(s)},addChild:function(e){var t,s=this.props.group;t="rule"===e?{type:"rule"}:{type:"group",activeOperator:0,children:[{type:"rule"}]},s.children.push(t),this.props.index?this.props.updateGroup(this.props.index,s):this.props.updateFilter(s)},deleteChild:function(e){var t=this.props.group;t.children.splice(e,1),t.session=getSessions(t),this.props.index?this.props.updateGroup(this.props.index,t):this.props.updateFilter(t)},render:function(){var e,t=React.createElement(s,{logicOperator:this.props.group.activeOperator,updateGroupOperator:this.updateGroupOperator}),i=this,l=this.props.group.children.map(function(e,t){return"rule"===e.type?React.createElement("li",{className:"treeChild"},React.createElement(a,{rule:e,items:i.props.items,index:t,updateRule:i.updateChild,updateSessions:i.updateSessions,deleteRule:i.deleteChild,Visits:i.props.Visits})):"group"===e.type?React.createElement("li",{className:"treeChild"},React.createElement(r,{group:e,items:i.props.items,index:t,updateGroup:i.updateChild,updateSessions:i.updateSessions,deleteGroup:i.deleteChild,Visits:i.props.Visits})):void 0});return this.props.deleteGroup&&(e=React.createElement("button",{className:"btn btn-danger btn-sm pull-right",onClick:this.props.deleteGroup.bind(this,this.props.index)},React.createElement("span",{className:"glyphicon glyphicon-remove"})," Delete Group")),React.createElement("div",{className:"tree"},React.createElement("ul",{className:"firstUL"},React.createElement("li",{className:"treeChild"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-xs-2"},t),React.createElement("div",{className:"col-xs-10"},e,React.createElement("button",{className:"btn btn-primary btn-sm pull-right",onClick:this.addChild.bind(this,"group")},React.createElement("span",{className:"glyphicon glyphicon-add"})," Add Group"),React.createElement("button",{className:"btn btn-primary btn-sm pull-right",onClick:this.addChild.bind(this,"rule")},React.createElement("span",{className:"glyphicon glyphicon-add"})," Add Rule"))),React.createElement("ul",null,l))))}}),i=React.createClass({displayName:"FilterBuilder",render:function(){return React.createElement("div",null,React.createElement("h1",{className:"col-xs-12"},"Filter"),React.createElement("div",{className:"col-xs-12"},React.createElement("div",{className:"well well-primary"},React.createElement(r,{group:this.props.filter,items:this.props.items,updateFilter:this.props.updateFilter,Visits:this.props.Visits}))))}});window.LogicOperator=s,window.FilterRule=a,window.FilterGroup=r,window.FilterBuilder=i,t.default={LogicOperator:s,FilterRule:a,FilterGroup:r,FilterBuilder:i}}]);
//# sourceMappingURL=react.filterBuilder.js.map